Todo:
-----

-- (possibly ruby yields for macros)
-- make pair function smaller (get rid of temps for self-copies)
